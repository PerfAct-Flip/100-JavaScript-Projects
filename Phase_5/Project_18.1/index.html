<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <style></style>
</head>

<body class="min-h-screen flex justify-center items-center">
    <div class="w-full md:w-1/2 lg:w-1/3 h-[50vh] flex flex-col bg-white rounded-3xl overflow-hidden shadow-2xl">
        <div
            class="headingContainer rounded-md px-4 py-1 bg-indigo-700 text-zinc-50 rounded-t-2xl px-4 py-3 text-white shadow-md">
            <h1 class="heading text-xl font-bold ">Currency Converter</h1>
        </div>

        <div class="font-mono pt-2 m-2 flex flex-row">
            <label for="url" class="mx-2 py-1 px-4">Enter Value:</label>
            <input type="number" name="value" id="enteredValue" placeholder="Type value"
                class="bg-zinc-200 rounded-xl mx-2 py-1 px-4 w-3/4">

        </div>
        <div>
            <label for="fromCurrency" class="block text-sm font-medium text-gray-700 mb-1">From Currency</label>

            <!-- THE <select> TAG CREATES THE DROPDOWN CONTAINER -->
            <select id="fromCurrency"
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 pr-10 transition duration-150">

            </select>
        </div>

        <div>
            <label for="fromCurrency" class="block text-sm font-medium text-gray-700 mb-1">To Currency</label>

            <!-- THE <select> TAG CREATES THE DROPDOWN CONTAINER -->
            <select id="toCurrency"
                class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 pr-10 transition duration-150">
            </select>
        </div>

        <div class="font-mono pt-2 m-2 flex flex-col justify-center items-center">
            <button id="convertBtn"
                class="rounded-xl px-2 py-1 w-1/4 bg-indigo-700 text-zinc-50 hover:bg-indigo-900">Convert</button>

            <!-- new shortened link  -->
            <div id="convertedValue" class="px-2 py-4">
                <!-- shortened link is inserted here  -->
            </div>

        </div>


    </div>

    <script>

        const enteredValue = document.getElementById('enteredValue');
        const fromCurrency = document.getElementById('fromCurrency');
        const toCurrency = document.getElementById('toCurrency');
        const convertBtn = document.getElementById('convertBtn');
        const convertedValue = document.getElementById('convertedValue');

        const currencyData = [
            { code: "USD", name: "US Dollar", value: 1.00 },
            { code: "EUR", name: "Euro", value: 0.93 },
            { code: "GBP", name: "British Pound", value: 0.81 },
            { code: "JPY", name: "Japanese Yen", value: 151.00 },
            { code: "CAD", name: "Canadian Dollar", value: 1.38 },
            { code: "AUD", name: "Australian Dollar", value: 1.55 },
            { code: "CHF", name: "Swiss Franc", value: 0.90 },
            { code: "CNY", name: "Chinese Yuan", value: 7.30 },
            { code: "INR", name: "Indian Rupee", value: 83.50 },
            { code: "BRL", name: "Brazilian Real", value: 5.20 },
            { code: "MXN", name: "Mexican Peso", value: 17.50 },
            { code: "KRW", name: "South Korean Won", value: 1360.00 },
            { code: "SGD", name: "Singapore Dollar", value: 1.37 },
            { code: "HKD", name: "Hong Kong Dollar", value: 7.82 },
            { code: "DKK", name: "Danish Krone", value: 7.00 },
            { code: "NOK", name: "Norwegian Krone", value: 11.20 },
            { code: "SEK", name: "Swedish Krona", value: 11.20 },
            { code: "NZD", name: "New Zealand Dollar", value: 1.70 },
            { code: "MYR", name: "Malaysian Ringgit", value: 4.75 },
            { code: "THB", name: "Thai Baht", value: 36.80 },
            { code: "TWD", name: "New Taiwan Dollar", value: 32.50 },
            { code: "ZAR", name: "South African Rand", value: 18.70 },
            { code: "LKR", name: "Sri Lankan Rupee", value: 305.00 },
            { code: "IRR", name: "Iranian Rial", value: 42000.00 },
            // Obsolete European Currencies
            { code: "ATS", name: "Austrian Schilling (Obsolete)", value: null },
            { code: "BEF", name: "Belgian Franc (Obsolete)", value: null },
            { code: "DEM", name: "German Mark (Obsolete)", value: null },
            { code: "ESP", name: "Spanish Peseta (Obsolete)", value: null },
            { code: "FIM", name: "Finnish Markka (Obsolete)", value: null },
            { code: "FRF", name: "French Franc (Obsolete)", value: null },
            { code: "GRD", name: "Greek Drachma (Obsolete)", value: null },
            { code: "IEP", name: "Irish Pound (Obsolete)", value: null },
            { code: "ITL", name: "Italian Lira (Obsolete)", value: null },
            { code: "NLG", name: "Dutch Guilder (Obsolete)", value: null },
            { code: "PTE", name: "Portuguese Escudo (Obsolete)", value: null }
        ];

        function assignValue(code, name, currencyId) {
            const currencyOption = document.createElement('option');
            currencyOption.value = code;
            currencyOption.textContent = `${name}(${code})`;
            currencyId.appendChild(currencyOption);
        }
        currencyData.forEach(currency => {
            const code = currency.code;
            const name = currency.name;
            assignValue(code, name, fromCurrency);
            assignValue(code, name, toCurrency);


        });

        convertBtn.addEventListener('click', async () => {
            const baseCurrency = fromCurrency.value;
            const targetCurrency = toCurrency.value;
            const finalConversionResult = await buildConversionUrl(baseCurrency, targetCurrency, enteredValue.value);

            console.log("Final Conversion Result:", finalConversionResult);
            convertedValue.textContent = finalConversionResult;
        })



        async function buildConversionUrl(baseCurrency, targetCurrency, amount) {

            const proxyServer = 'http://localhost:3000/api/convert?'

            const params = new URLSearchParams();
            params.set('from', baseCurrency);
            params.set('to', targetCurrency);
            params.set('amount', amount);

            const response = await fetch(proxyServer + params.toString());
            const data = await response.json();

            return data.conversion_result;
        }

        // // --- Example Usage ---
        //
        // const from = "USD";
        // const to = "INR";
        // const value = 2;

        // (async () => {
        //     const finalConversionResult = await buildConversionUrl(myKey, from, to, value);

        //     console.log("Final Conversion Result:", finalConversionResult);
        // })();

    </script>
</body>

</html>