<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortner</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen flex justify-center items-center">
    <div class="w-full md:w-1/2 lg:w-1/3 h-[50vh] flex flex-col bg-white rounded-3xl overflow-hidden shadow-2xl">
        <div
            class="headingContainer rounded-md px-4 py-1 bg-indigo-700 text-zinc-50 rounded-t-2xl px-4 py-3 text-white shadow-md">
            <h1 class="heading text-xl font-bold ">URL Shortner</h1>
        </div>
        <div class="font-mono pt-2 m-2 flex flex-row">
            <label for="url" class="mx-2 py-1 px-4">URL:</label>
            <input type="url" name="Url" id="enteredUrl" placeholder="Type your url here..."
                class="bg-zinc-200 rounded-xl mx-2 py-1 px-4 w-3/4">

        </div>
        <div class="font-mono pt-2 m-2 flex flex-row">
            <label for="custom" class="mx-2 py-1 px-1">Custom:</label>
            <input type="url" name="Custom" id="enteredCustom" placeholder="Type your custom here..."
                class="bg-zinc-200 rounded-xl mx-2 py-1 px-4 w-3/4">

        </div>
        <div class="font-mono pt-2 m-2 flex flex-col justify-center items-center">
            <button id="generateBtn"
                class="rounded-xl px-2 py-1 w-1/4 bg-indigo-700 text-zinc-50 hover:bg-indigo-900">Generate</button>

            <!-- new shortened link  -->
            <div id="shorternedLinkData" class="px-2 py-4">
                <!-- shortened link is inserted here  -->
            </div>

        </div>
    </div>
    <script>
        const generateBtn = document.getElementById('generateBtn');
        generateBtn.addEventListener('click', async () => {
            const enteredUrl = document.getElementById('enteredUrl').value.trim();
            const enteredCustom = document.getElementById('enteredCustom').value.trim();
            const params = new URLSearchParams();
            params.set('url', enteredUrl);
            if (enteredCustom) params.set('custom', enteredCustom);
            params.set('private', '0');
            params.set('type', 'json');

            const proxyServer = 'http://localhost:3000/shorten?'
            const response = await fetch(proxyServer + params.toString());

            if (!response.ok) throw new Error('HTTP error ' + response.status);

            const data = await response.json();
            const shortURL = data.data.url;

            const urlLink = document.createElement('a');
            urlLink.href = shortURL;
            urlLink.textContent = shortURL;
            const stlyingClasses = 'text-indigo-700'
            urlLink.classList.add(stlyingClasses)

            const linkLine = document.createElement('p');
            
            

            const shorternedLinkData = document.getElementById('shorternedLinkData');

            if (shortURL) {
                linkLine.textContent = "Shortened URL:";
                linkLine.appendChild(urlLink);
            } else {
                linkLine.textContent = "Unexpected response format.";
            }

            shorternedLinkData.appendChild(linkLine);


        })
    </script>
</body>


</html>